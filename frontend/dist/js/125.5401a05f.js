"use strict";(self["webpackChunksmart_recycling_frontend"]=self["webpackChunksmart_recycling_frontend"]||[]).push([[125],{125:(e,a,t)=>{t.r(a),t.d(a,{default:()=>Z});var l=t(641),n=t(33);const s={class:"recycling"},c={class:"container"},o={class:"recycling-grid"},r={class:"camera-section card"},i={key:0,class:"results-section card"},u={class:"result-content"},d={class:"result-item"},p={class:"result-item"},g={key:0,class:"result-item"},v={class:"text-success"},y={key:0,class:"nearest-location"},m={class:"location-info"},h={class:"map-section card"},k={key:0,class:"history-section card"},b={class:"history-list"},f={class:"item-type"},C={class:"item-date"};function R(e,a,t,L,R,_){const w=(0,l.g2)("CameraCapture"),I=(0,l.g2)("RecyclingMap");return(0,l.uX)(),(0,l.CE)("div",s,[(0,l.Lk)("div",c,[(0,l.Lk)("h1",null,(0,n.v_)(e.$t("recycling.title")),1),(0,l.Lk)("div",o,[(0,l.Lk)("div",r,[(0,l.Lk)("h2",null,(0,n.v_)(e.$t("recycling.scanMaterials")),1),(0,l.bF)(w,{onItemProcessed:L.handleItemProcessed},null,8,["onItemProcessed"])]),L.processingResult?((0,l.uX)(),(0,l.CE)("div",i,[(0,l.Lk)("h2",null,(0,n.v_)(e.$t("recycling.scanResults")),1),(0,l.Lk)("div",u,[(0,l.Lk)("div",d,[(0,l.Lk)("strong",null,(0,n.v_)(e.$t("recycling.materialType"))+":",1),(0,l.Lk)("span",{class:(0,n.C4)({recyclable:L.processingResult.isRecyclable,"not-recyclable":!L.processingResult.isRecyclable})},(0,n.v_)(e.$t("materials."+L.processingResult.itemType)),3)]),(0,l.Lk)("div",p,[(0,l.Lk)("strong",null,(0,n.v_)(e.$t("recycling.recyclable"))+":",1),(0,l.Lk)("span",{class:(0,n.C4)(L.processingResult.isRecyclable?"text-success":"text-danger")},(0,n.v_)(L.processingResult.isRecyclable?e.$t("recycling.recyclable"):e.$t("recycling.notRecyclable")),3)]),L.processingResult.pointsEarned>0?((0,l.uX)(),(0,l.CE)("div",g,[(0,l.Lk)("strong",null,(0,n.v_)(e.$t("recycling.pointsEarned"))+":",1),(0,l.Lk)("span",v,"+"+(0,n.v_)(L.processingResult.pointsEarned),1)])):(0,l.Q3)("",!0)]),L.processingResult.nearestLocation?((0,l.uX)(),(0,l.CE)("div",y,[(0,l.Lk)("h3",null,"ğŸ“ "+(0,n.v_)(e.$t("recycling.nearestLocation")),1),(0,l.Lk)("div",m,[(0,l.Lk)("strong",null,(0,n.v_)(L.processingResult.nearestLocation.name),1),(0,l.Lk)("p",null,(0,n.v_)(L.processingResult.nearestLocation.address),1),(0,l.Lk)("p",null,(0,n.v_)(e.$t("recycling.distance"))+": "+(0,n.v_)(L.calculateDistance(L.processingResult.nearestLocation))+" "+(0,n.v_)(e.$t("recycling.km")),1)])])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),(0,l.Lk)("div",h,[(0,l.Lk)("h2",null,(0,n.v_)(e.$t("recycling.recyclingLocations")),1),(0,l.bF)(I,{locations:L.locations,"user-location":L.userLocation,"selected-location":L.processingResult?.nearestLocation},null,8,["locations","user-location","selected-location"])])]),L.recyclingHistory.length>0?((0,l.uX)(),(0,l.CE)("div",k,[(0,l.Lk)("h2",null,(0,n.v_)(e.$t("recycling.recyclingHistory")),1),(0,l.Lk)("div",b,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(L.recyclingHistory.slice(0,5),a=>((0,l.uX)(),(0,l.CE)("div",{key:a.id,class:"history-item"},[(0,l.Lk)("div",f,(0,n.v_)(e.$t("materials."+a.item_type)),1),(0,l.Lk)("div",{class:(0,n.C4)(["item-status",a.is_recyclable?"recyclable":"not-recyclable"])},(0,n.v_)(a.is_recyclable?e.$t("recycling.recyclable"):e.$t("recycling.notRecyclable")),3),(0,l.Lk)("div",C,(0,n.v_)(L.formatDate(a.created_at)),1)]))),128))])])):(0,l.Q3)("",!0)])])}var _=t(953);const w={class:"camera-capture"},I={key:0,class:"camera-container"},E={class:"camera-controls"},$={key:1,class:"preview-container"},M=["src"],P={class:"preview-controls"},K=["disabled"],A={key:2,class:"upload-section"},x={key:3,class:"error-message"};function X(e,a,t,s,c,o){return(0,l.uX)(),(0,l.CE)("div",w,[s.isCaptured?((0,l.uX)(),(0,l.CE)("div",$,[(0,l.Lk)("img",{src:s.capturedImage,alt:"Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„ØªÙ‚Ø·Ø©",class:"preview-image"},null,8,M),(0,l.Lk)("div",P,[(0,l.Lk)("button",{onClick:a[3]||(a[3]=(...e)=>s.retakePhoto&&s.retakePhoto(...e)),class:"btn btn-secondary"},(0,n.v_)(e.$t("recycling.retakePhoto")),1),(0,l.Lk)("button",{onClick:a[4]||(a[4]=(...e)=>s.processImage&&s.processImage(...e)),class:"btn btn-primary",disabled:s.processing},(0,n.v_)(s.processing?e.$t("recycling.processing"):e.$t("recycling.analyzeMaterial")),9,K)])])):((0,l.uX)(),(0,l.CE)("div",I,[(0,l.Lk)("video",{ref:"videoElement",autoplay:"",playsinline:"",class:(0,n.C4)(["camera-view",{"is-flipped":s.shouldFlipCamera}])},null,2),(0,l.Lk)("div",E,[(0,l.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>s.captureImage&&s.captureImage(...e)),class:"btn btn-primary capture-btn"},(0,n.v_)(e.$t("recycling.takePhoto")),1),(0,l.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>s.toggleCamera&&s.toggleCamera(...e)),class:"btn btn-secondary"},(0,n.v_)(e.$t("recycling.switchCamera")),1),(0,l.Lk)("button",{onClick:a[2]||(a[2]=(...e)=>s.uploadImage&&s.uploadImage(...e)),class:"btn btn-secondary"},(0,n.v_)(e.$t("recycling.uploadImage")),1)])])),s.isCaptured?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",A,[(0,l.Lk)("input",{type:"file",ref:"fileInput",onChange:a[5]||(a[5]=(...e)=>s.handleFileUpload&&s.handleFileUpload(...e)),accept:"image/*",style:{display:"none"}},null,544)])),s.error?((0,l.uX)(),(0,l.CE)("div",x,(0,n.v_)(s.error),1)):(0,l.Q3)("",!0)])}var F=t(295);const D={name:"CameraCapture",emits:["item-processed"],setup(e,{emit:a}){const t=(0,_.KR)(null),n=(0,_.KR)(null),s=(0,_.KR)(!1),c=(0,_.KR)(""),o=(0,_.KR)(!1),r=(0,_.KR)(""),i=(0,_.KR)(null),u=(0,_.KR)(!1),d=(0,_.KR)(null),p=()=>new Promise((e,a)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{d.value={latitude:a.coords.latitude,longitude:a.coords.longitude},e(d.value)},e=>{a(e)}):a(new Error("Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…"))}),g=async()=>{try{const e={video:{facingMode:u.value?"environment":"user"}};i.value=await navigator.mediaDevices.getUserMedia(e),t.value&&(t.value.srcObject=i.value)}catch(e){console.error("Error starting camera:",e),r.value="ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª."}},v=()=>{i.value&&(i.value.getTracks().forEach(e=>e.stop()),i.value=null)},y=()=>{u.value=!u.value,v(),g()},m=()=>{if(!t.value)return;const e=document.createElement("canvas"),a=e.getContext("2d");e.width=t.value.videoWidth,e.height=t.value.videoHeight,u.value||(a.translate(e.width,0),a.scale(-1,1)),a.drawImage(t.value,0,0,e.width,e.height),c.value=e.toDataURL("image/jpeg"),s.value=!0,v()},h=()=>{s.value=!1,c.value="",g()},k=()=>{n.value?.click()},L=e=>{const a=e.target.files[0];if(a){const e=new FileReader;e.onload=e=>{c.value=e.target.result,s.value=!0,v()},e.readAsDataURL(a)}},b=async()=>{if(c.value&&d.value){o.value=!0,r.value="";try{const e=await fetch(c.value),t=await e.blob(),l=new File([t],"recycling-item.jpg",{type:"image/jpeg"}),n=new FormData;n.append("image",l),n.append("latitude",d.value.latitude),n.append("longitude",d.value.longitude);const s=await F.A.processItem(n);a("item-processed",s.data)}catch(e){console.error("Error processing image:",e),r.value=e.response?.data?.message||"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©"}finally{o.value=!1}}else r.value="ÙŠØ¬Ø¨ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© ÙˆØ§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹"};return(0,l.sV)(async()=>{try{await p(),await g()}catch(e){r.value="ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¹Ø§Ù…Ø©.",await g()}}),(0,l.hi)(()=>{v()}),{videoElement:t,fileInput:n,isCaptured:s,capturedImage:c,processing:o,error:r,shouldFlipCamera:u,captureImage:m,retakePhoto:h,toggleCamera:y,uploadImage:k,handleFileUpload:L,processImage:b}}};var T=t(262);const U=(0,T.A)(D,[["render",X],["__scopeId","data-v-5c93bd0e"]]),j=U,H={class:"recycling-map"},Q={ref:"mapContainer",class:"map-container"},S={class:"map-legend"},z={class:"legend-label"};function V(e,a,t,s,c,o){return(0,l.uX)(),(0,l.CE)("div",H,[(0,l.Lk)("div",Q,null,512),(0,l.Lk)("div",S,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.legendItems,e=>((0,l.uX)(),(0,l.CE)("div",{class:"legend-item",key:e.type},[(0,l.Lk)("span",{class:"legend-color",style:(0,n.Tr)({backgroundColor:e.color})},null,4),(0,l.Lk)("span",z,(0,n.v_)(e.label),1)]))),128))])])}const O={name:"RecyclingMap",props:{locations:{type:Array,default:()=>[]},userLocation:{type:Object,default:null},selectedLocation:{type:Object,default:null}},setup(e){const a=(0,_.KR)(null),t=(0,_.KR)(null),n=(0,_.KR)([]),s=[{type:"plastic",color:"#007bff",label:"Ø¨Ù„Ø§Ø³ØªÙŠÙƒ"},{type:"paper",color:"#28a745",label:"ÙˆØ±Ù‚"},{type:"glass",color:"#6f42c1",label:"Ø²Ø¬Ø§Ø¬"},{type:"metal",color:"#fd7e14",label:"Ù…Ø¹Ø§Ø¯Ù†"},{type:"general",color:"#6c757d",label:"Ø¹Ø§Ù…"},{type:"user",color:"#dc3545",label:"Ù…ÙˆÙ‚Ø¹Ùƒ"},{type:"selected",color:"#ffc107",label:"Ù…Ø­Ø¯Ø¯"}],c=e=>{const a={plastic:"#007bff",paper:"#28a745",glass:"#6f42c1",metal:"#fd7e14",general:"#6c757d"};return a[e]||"#6c757d"},o=(e,a=!1)=>L.divIcon({className:"recycling-marker "+(a?"selected":""),html:`\n          <div style="\n            background-color: ${e};\n            width: 25px;\n            height: 25px;\n            border-radius: 50%;\n            border: 3px solid white;\n            box-shadow: 0 2px 5px rgba(0,0,0,0.3);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            font-size: 12px;\n            font-weight: bold;\n          ">â™»ï¸</div>\n        `,iconSize:[25,25],iconAnchor:[12,12]}),r=()=>{if(!a.value)return;if(!window.L)return void console.error("Leaflet not loaded");const e=[24.7136,46.6753];t.value=L.map(a.value).setView(e,12),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap contributors",maxZoom:18}).addTo(t.value),i()},i=()=>{if(t.value){if(n.value.forEach(e=>t.value.removeLayer(e)),n.value=[],e.userLocation){const a=L.divIcon({className:"user-location-marker",html:"ğŸ“",iconSize:[30,30],iconAnchor:[15,30]}),l=L.marker([e.userLocation.lat,e.userLocation.lng],{icon:a}).addTo(t.value);l.bindPopup("ğŸ“ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ"),n.value.push(l),t.value.setView([e.userLocation.lat,e.userLocation.lng],13)}e.locations.forEach(a=>{const l=e.selectedLocation&&e.selectedLocation.id===a.id,s=l?"#ffc107":c(a.type),r=o(s,l),i=L.marker([a.latitude,a.longitude],{icon:r}).addTo(t.value),d=`\n          <div class="map-popup">\n            <h4>${a.name}</h4>\n            <p>${a.address}</p>\n            <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${u(a.type)}</p>\n            ${a.distance?`<p><strong>Ø§Ù„Ù…Ø³Ø§ÙØ©:</strong> ${a.distance} ÙƒÙ…</p>`:""}\n          </div>\n        `;i.bindPopup(d),n.value.push(i),l&&i.openPopup()})}},u=e=>{const a={plastic:"Ø¨Ù„Ø§Ø³ØªÙŠÙƒ",paper:"ÙˆØ±Ù‚",glass:"Ø²Ø¬Ø§Ø¬",metal:"Ù…Ø¹Ø§Ø¯Ù†",general:"Ø¹Ø§Ù…"};return a[e]||e},d=()=>{if(window.L)r();else{const e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(e);const a=document.createElement("script");a.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",a.onload=r,document.head.appendChild(a)}};return(0,l.sV)(()=>{d()}),(0,l.hi)(()=>{t.value&&t.value.remove()}),(0,l.wB)(()=>e.locations,i),(0,l.wB)(()=>e.selectedLocation,i),(0,l.wB)(()=>e.userLocation,i),{mapContainer:a,legendItems:s,getArabicType:u}}},B=(0,T.A)(O,[["render",V],["__scopeId","data-v-221464de"]]),q=B,N={name:"Recycling",components:{CameraCapture:j,RecyclingMap:q},setup(){const e=(0,_.KR)(null),a=(0,_.KR)([]),t=(0,_.KR)([]),n=(0,_.KR)(null),s=e=>{if(!n.value)return"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";const a=6371,t=(e.latitude-n.value.lat)*Math.PI/180,l=(e.longitude-n.value.lng)*Math.PI/180,s=Math.sin(t/2)*Math.sin(t/2)+Math.cos(n.value.lat*Math.PI/180)*Math.cos(e.latitude*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2),c=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),o=a*c;return o.toFixed(1)},c=e=>new Date(e).toLocaleDateString("ar-SA"),o=a=>{e.value=a,i()},r=async()=>{try{const e=n.value?{lat:n.value.lat,lng:n.value.lng}:{},t=await F.A.getLocations(e);a.value=t.data}catch(e){console.error("Error fetching locations:",e)}},i=async()=>{try{const e=await F.A.getUserHistory();t.value=e.data}catch(e){console.error("Error fetching history:",e)}},u=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{n.value={lat:e.coords.latitude,lng:e.coords.longitude},r()},e=>{console.error("Error getting location:",e),r()}):r()};return(0,l.sV)(()=>{u(),i()}),{processingResult:e,locations:a,recyclingHistory:t,userLocation:n,handleItemProcessed:o,calculateDistance:s,formatDate:c}}},W=(0,T.A)(N,[["render",R],["__scopeId","data-v-9e8c98f8"]]),Z=W},295:(e,a,t)=>{t.d(a,{A:()=>s});var l=t(889);const n={processItem:e=>l.A.post("/recycling/process",e,{headers:{"Content-Type":"multipart/form-data"}}),getLocations:e=>l.A.get("/recycling/locations",{params:e}),getUserHistory:()=>l.A.get("/recycling/history"),getUserStats:()=>l.A.get("/users/stats")},s=n}}]);
//# sourceMappingURL=125.5401a05f.js.map